package firstservlet;

import java.io.IOException;

import java.io.PrintWriter;
import java.util.*;

import javax.servlet.annotation.WebServlet;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import com.google.gson.*;
import firstservlet.Flight;
import java.sql.*;




@WebServlet("/getFlight")
public class ReturnAllFlight extends HttpServlet{
		/**
	 * 
	 */
	private Gson gson = new Gson();
	private static final long serialVersionUID = 1L;

		public void doGet(HttpServletRequest req, HttpServletResponse res) throws IOException {
			
			
			
			String url = "jdbc:postgresql://localhost:5432/flight";
			String username = "postgres";

			String password = "password";
			String query = "select * from flight_details.flights";
			try {
				Class.forName("org.postgresql.Driver");
			} catch (ClassNotFoundException e) {
				// TODO Auto-generated catch block
				e.printStackTrace();
			} 
			try {
				Connection con = DriverManager.getConnection(url,username,password);
				Statement st = con.createStatement();
				ResultSet rs = st.executeQuery(query);
				rs.next();
				Flight f1 = new Flight(rs.getString(2),rs.getString(3));
				rs.next();
				Flight f2 = new Flight(rs.getString(2),rs.getString(3));
				ArrayList<Flight> l = new ArrayList<Flight>();
				l.add(f1);
				l.add(f2);
				res.setContentType("application/json");
				PrintWriter out = res.getWriter();
				out.print(gson.toJson(l));
				out.flush();
				
			} catch (SQLException e) {
				// TODO Auto-generated catch block
				e.printStackTrace();
			}

			//ArrayList<Flight> l = new ArrayList<Flight>();
			
			
		}
}
